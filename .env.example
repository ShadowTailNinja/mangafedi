# ─────────────────────────────────────────────────────
# TIER 1 – STARTUP CONFIG (requires restart)
# ─────────────────────────────────────────────────────

# Core
NODE_ENV=production
PORT=3000
BASE_URL=https://manga.example.com
RUN_MODE=all                    # "all" | "web" | "worker"

# Database – app traffic (via PgBouncer, transaction mode)
DATABASE_PRIMARY_URL=postgres://manga:password@pgbouncer:6432/manga
DATABASE_REPLICA_URL=           # Optional. Falls back to PRIMARY if unset.

# Database – federation queue (DIRECT to Postgres – bypasses PgBouncer)
DATABASE_QUEUE_URL=postgres://manga:password@db:5432/manga

# Queue backend
QUEUE_BACKEND=postgres          # "postgres" | "redis"
REDIS_URL=                      # Required only if QUEUE_BACKEND=redis

# Object storage (S3-compatible)
STORAGE_ENDPOINT=https://s3.example.com
STORAGE_BUCKET=mangafedi-assets
STORAGE_ACCESS_KEY_ID=
STORAGE_SECRET_ACCESS_KEY=
STORAGE_REGION=auto
STORAGE_PUBLIC_URL=https://cdn.example.com
STORAGE_FORCE_PATH_STYLE=false               # true for MinIO

# Backup storage
BACKUP_STORAGE_BUCKET=mangafedi-backups
BACKUP_STORAGE_PREFIX=db/

# Security
SESSION_SECRET=                 # 64 random bytes, hex-encoded
PORTABLE_KEY_HMAC_SECRET=       # 32 random bytes

# Image processing
IMAGE_MAX_UPLOAD_MB=50
IMAGE_PROCESSING_CONCURRENCY=2
IMAGE_MAX_DIMENSION_PX=4000

# Archive upload
ARCHIVE_MAX_UPLOAD_MB=200
ARCHIVE_MAX_PAGES=500

# Federation
FEDERATION_WORKER_CONCURRENCY=4
FEDERATION_MAX_OUTBOUND_PER_DOMAIN_PER_MINUTE=60

# Feature flags
ENABLE_REGISTRATION=true
ENABLE_FEDERATION=true
ENABLE_UPLOAD=true
ENABLE_ARCHIVE_UPLOAD=true
